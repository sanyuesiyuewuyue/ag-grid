@import '../vars/ag-theme-alpine-vars';
@import '../../ag-theme-base/sass/ag-theme-base';
@import './ag-theme-alpine-mixins';

@include ag-icons-font-face();

@mixin ag-theme-alpine() {
    @include ag-grid-theme();

    color: $ag-color-foreground;

    &.ag-popup {
        color: $ag-color-foreground;
    }

    .ag-header-cell {
        border-color: $ag-border-color;
    }

    ////////////////////////////////////////
    // filter menu
    ////////////////////////////////////////
    .ag-filter {
        .ag-filter-body-wrapper {
            padding: $ag-grid-size * 2;
            .ag-filter-select,
            .ag-filter-body,
            .ag-filter-filter {
                margin: 0;
            }

            .ag-filter-select,
            .ag-filter-body,
            .ag-filter-condition {
                &:not(:last-child) {
                    margin-bottom: $ag-grid-size * 2;
                }
            }

            .ag-filter-filter {
                @extend %input-text;
            }

            .ag-filter-select {
                @extend %select;
            }

            .ag-input-wrapper {
                overflow: visible;
            }
        }

        .ag-filter-apply-panel {
            padding: 0;
            padding-top: $ag-grid-size * 3;
            margin: $ag-grid-size * 2;
            margin-top: 0;
            border-top: 1px solid $ag-border-color;

            button {
                @extend %button;
            }

            button[ref='eClearButton'] {
                @extend %reset-button;
            }
        }

        .ag-filter-condition input[type='radio'] {
            @extend %radio-button;
        }

        .ag-filter-condition label {
            @extend %label;
            display: inline-block;
            margin: 0;
            margin-left: $ag-grid-size * 1;
        }

        .ag-native-checkbox {
            @include ag-checkbox($ag-color-primary);
        }
    }

    .ag-filter-header-container {
        margin-bottom: $ag-grid-size;
        .ag-set-filter-item {
            margin-top: $ag-grid-size;
            margin-bottom: $ag-grid-size;
        }
    }
    ////////////////////////////////////////
    // context menu and enterprise column menu
    ////////////////////////////////////////
    .ag-menu {

        .ag-menu-list {
            margin: 0;
        }
    }

    .ag-menu-list {
        font: $ag-font-chrome;
        padding: $ag-grid-size * 2;
        margin: 0;

        .ag-menu-option > span {
            padding-top: $ag-grid-size;
            padding-bottom: $ag-grid-size;
        }

        .ag-menu-option-shortcut {
            text-align: right;
            font-size: 0.7rem;
            vertical-align: super;
            opacity: 0.7;
        }
    }

    .ag-tabs-header {
        min-width: 250px;
        justify-content: center;
        @include ag-grid-border(bottom);
    }

    .ag-tab {
        padding: $ag-grid-size $ag-grid-size * 4;
        height: $ag-grid-size * 6;
    }

    .ag-tab-selected {
        color: $ag-color-primary;
    }

    ////////////////////////////////////////
    // Popup
    ////////////////////////////////////////
    .ag-popup-child:not(.ag-tooltip-custom) {
        @include ag-chrome-box-shadow();
        border: 1px solid $ag-secondary-border-color;
        border-radius: $ag-border-radius;
        @include ag-chrome-box-shadow();
    }

    &.ag-dnd-ghost {
        @include ag-chrome-box-shadow();
        border-radius: $ag-border-radius;
    }

    ////////////////////////////////////////
    // Selection Checkbox
    ////////////////////////////////////////
    .ag-selection-checkbox input {
        @include ag-checkbox;
    }

    ////////////////////////////////////////
    // Header Checkbox
    ////////////////////////////////////////
    .ag-checkbox {
        .ag-input-wrapper {
            overflow: visible;
        }

        input {
            @include ag-checkbox;
        }
    }

    ////////////////////////////////////////
    // Header Checkbox
    ////////////////////////////////////////
    .ag-tooltip {
        font-size: $ag-size-font-tooltip;
        padding: $ag-grid-size / 2 $ag-grid-size;
    }


    ////////////////////////////////////////
    // Pinned Containers
    ////////////////////////////////////////
    .ag-pinned-left-header,
    .ag-root:not(.ag-has-focus) .ag-cell.ag-cell-last-left-pinned:not(.ag-cell-range-right) {
        border-right: 1px solid $ag-border-color !important;
    }

    .ag-pinned-right-header {
        border-left-color: $ag-border-color;
    }


    .ag-ltr .ag-root:not(.ag-has-focus) .ag-cell.ag-cell-first-right-pinned:not(.ag-cell-range-left) {
        border-left-color: $ag-border-color;
    }

    ////////////////////////////////////////
    // Floating Filter
    ////////////////////////////////////////
    input:not([type]) {
        @extend %input-text;
        border-color: $ag-color-border-form-element;
        font-size: smaller;
    }

    .ag-floating-filter-body {
        .ag-input-wrapper {
            overflow: visible;
        }
    }
    .ag-ltr .ag-floating-filter-button {
        margin-left: $ag-grid-size / 2;
    }
    .ag-floating-filter-button {
        button {
            @extend %button;
            background-position: right $ag-grid-size / 2 top $ag-grid-size / 2;
            padding: $ag-grid-size - 1;
            height: $ag-icon-size + $ag-grid-size * 2 - 2;
            width: $ag-grid-size * 5;
            border-radius: $ag-border-radius;
            border: 1px solid $ag-color-border-form-element;
            text-align: left;

            .ag-icon {
                color: $ag-color-border-form-element;
            }

            &:hover .ag-icon {
                color: $ag-color-primary;
            }

            &:active .ag-icon {
                color: $ag-color-background;
            }
        }
    }

    ////////////////////////////////////////
    // Navigation
    ////////////////////////////////////////

    .ag-cell.ag-cell-inline-editing {
        @include ag-box-shadow($ag-selection-border-color);
        border-radius: 0;
        padding: 0;
        height: 100%;
        overflow: visible;

        // text editor
        .ag-input-wrapper .ag-cell-edit-input {
            @extend %input-text;
            border: 0;
            border-radius: 0;
            padding-left: $ag-grid-size * 3 - 1;
            padding-right: $ag-grid-size * 3 - 1;
            font: $ag-font-default;
        }

        // select editor
        .ag-cell-edit-input select {
            @extend %select;
            border: 0;
            border-radius: 0;
            padding-left: $ag-grid-size * 3 - 1;
            padding-right: $ag-grid-size * 3 - 1;
            background-position: right $ag-grid-size top $ag-row-height / 2 - 9;
            font: $ag-font-default;
        }
    }

    ////////////////////////////////////////
    // Popup editing
    ////////////////////////////////////////
    .ag-popup > div.ag-popup-editor {
        @include ag-box-shadow($ag-selection-border-color);
        min-height: $ag-row-height;
        border-color: $ag-color-primary;
        border-radius: 0;
        padding: 0;
        overflow: visible;
        box-sizing: border-box;

        // text editor
        .ag-input-wrapper .ag-cell-edit-input,
        .ag-cell-edit-input select {
            border: 0;
            border-radius: 0;
            padding-left: $ag-grid-size * 3 - 1;
            padding-right: $ag-grid-size * 6 - 1;
            font: $ag-font-default;
            line-height: $ag-row-height - $ag-grid-size * 2 - 2;
        }

        .ag-input-wrapper .ag-cell-edit-input {
            @extend %input-text;
        }

        // select editor
        .ag-cell-edit-input select {
            @extend %select;
            background-position: right $ag-grid-size top $ag-row-height / 2 - 9;
        }

        textarea {
            @extend %custom-selection;
            border: 0;
            color: $ag-color-foreground;
            background: $ag-color-background;
            font: $ag-font-default;
            padding: $ag-grid-size * 2 $ag-grid-size * 3;
        }
    }

    ////////////////////////////////////////
    // Rich Select
    ////////////////////////////////////////
    
    .ag-rich-select-value {
        border-bottom: 1px solid $ag-secondary-border-color;
    }

    .ag-rich-select-virtual-list-item {
        height: $ag-grid-size * 5;
    }

    .ag-rich-select-row-selected {
        @include ag-active-invert;
    }

    ////////////////////////////////////////
    // Column Chooser
    ////////////////////////////////////////
    .ag-column-select-header {
        border-top: 0;
        padding-left: $ag-grid-size * 1;
        padding-top: $ag-grid-size * 2;
        padding-bottom: $ag-grid-size * 2;
        height: auto;

        & > [ref='eExpand'] {
            margin-left: $ag-grid-size;
        }

        & > [ref='eExpand'].ag-hidden + div {
            margin-left: $ag-grid-size * 2;
        }

        .ag-checkbox {
            @include ag-checkbox($ag-color-primary);
        }

        .ag-input-wrapper {
            margin-right: $ag-grid-size * 2;
        }
    }

    .ag-column-select-list {
        margin-left: $ag-grid-size * 2;
        margin-right: $ag-grid-size * 2;
        padding-left: 0;
    }

    .ag-column-select-list .ag-checkbox input {
        @include ag-checkbox($ag-color-primary);
    }

    .ag-column-select-list .ag-column-group-icons {
        margin-left: 0;
    }

    .ag-column-select-list > div {
        height: $ag-grid-size * 5;
    }

    .ag-column-select-header-filter-wrapper.ag-input-wrapper {
        overflow: visible;
    }

    .ag-column-select-header-filter {
        @extend %input-box;
    }

    ////////////////////////////////////////
    // Overlay
    ////////////////////////////////////////
    .ag-overlay-loading-center {
        @include ag-chrome-box-shadow();
        border: 1px solid $ag-border-color;
        padding: $ag-grid-size * 2 $ag-grid-size * 3;
        font: $ag-font-default;
    }

    .ag-overlay-loading-wrapper {
        background-color: transparentize($ag-color-background, 0.25);
    }

    ////////////////////////////////////////
    // Grouping
    ////////////////////////////////////////
    .ag-group-checkbox input[type='checkbox'] {
        display: inline-block;
        vertical-align: middle;
        transform: translatey(-1px);
    }


    ////////////////////////////////////////
    // Group panel
    ////////////////////////////////////////

    .ag-column-drop-horizontal {
        // Align the first pill to the header
        font: $ag-font-chrome;
    }

    .ag-column-drop-cell {
        padding: 0;
    }

    .ag-column-drop-cell-drag-handle {
        margin-left: $ag-grid-size;
        transform: translateY(1px);
    }

    .ag-column-drop-cell-text {
        transform: translateY(-1px);
    }

    .ag-column-drop-cell-button {
        min-width: auto;
        transform: translateY(2px);
    }

    ////////////////////////////////////////
    // Status Bar
    ////////////////////////////////////////
    .ag-status-bar {
        border: 0;
        border-top: 1px solid $ag-border-color;
        font: $ag-font-chrome;
        font-size: $ag-size-font-status-bar;
        padding-left: $ag-cell-horizontal-padding;
        padding-right: $ag-cell-horizontal-padding;

        div.ag-status-name-value:first-child {
            margin-left: 0;
        }

        div.ag-status-name-value:last-child {
            margin-right: 0;
        }

        .ag-status-name-value-value {
            font-weight: 600;
        }
    }

    ////////////////////////////////////////
    // Side Bar
    ////////////////////////////////////////

    .ag-side-bar {
        font: $ag-font-chrome;
    }

    .ag-tool-panel-wrapper {
        background-color: $ag-color-background-alt;

        .ag-pivot-mode-select {
            margin-left: $ag-grid-size * 2;
            input {
                @include ag-toggle-button;
            }
        }
    }

    .ag-column-drop-vertical {
        padding-top: 0;
    }

    .ag-column-drop-vertical-title-bar {
        background-color: $ag-color-background;
        padding: $ag-grid-size * 2 $ag-grid-size * 2;
        @include ag-grid-border(bottom, $color: $ag-secondary-border-color);
    }

    .ag-column-drop-vertical-icon {
        margin-left: 0px;
        // display: none;
    }

    .ag-column-drop-vertical-list {
        padding: $ag-grid-size;
    }

    .ag-column-drop-vertical-empty-message {
        font-weight: inherit;
        opacity: 0.5;
        border: 1px dashed $ag-border-color;
        margin: $ag-grid-size * 2;
        padding: $ag-grid-size * 2;
    }

    // filter panel
    .ag-filter-toolpanel {
        .ag-filter-body-wrapper {
            padding: $ag-grid-size * 2;
            padding-top: $ag-grid-size;
        }

        .ag-filter-apply-panel {
            margin: 0;
            margin-bottom: $ag-grid-size;
            padding-top: $ag-grid-size * 2;
            justify-content: space-evenly;
            button {
                font-size: 0.8em;
                padding: $ag-grid-size / 2 $ag-grid-size;
            }
        }

        .ag-filter-toolpanel-instance {
            font-weight: $ag-weight-font-chrome;

            .ag-filter-toolpanel-header {
                padding: $ag-grid-size $ag-grid-size * 2;
                background-color: $ag-color-background;
                border-bottom: 1px solid $ag-border-color;

                [ref='eExpand'] {
                    margin-right: $ag-grid-size;
                }
            }

            .ag-filter-air {
                border-top: 0;
            }
        }
    }

    // side buttons
    .ag-side-buttons {
        width: $ag-grid-size * 5;
    }
    
    .ag-side-button.ag-selected {
        color: $ag-color-primary;
    }

    ////////////////////////////////////////
    // Dialog
    ////////////////////////////////////////
    
    .ag-chart {
        .ag-chart-menu {
            top: $ag-grid-size * 2;
            right: $ag-grid-size * 3;
            & > .ag-icon {
                opacity: 1;
                &:hover {
                    background: inherit;
                    color: $ag-color-primary;
                }
            }
        }

        .ag-chart-tabbed-menu {
            font: $ag-font-chrome;
        }

        .ag-tabs-body {
            background-color: $ag-color-background-alt;
        }

        .ag-chart-docked-container .ag-panel {
            border-left: 1px solid $ag-border-color;
        }

        .ag-chart-settings-nav-bar {
            border-top: 1px solid $ag-border-color;
        }

        // Data Tab
        .ag-chart-data {
            .ag-radio-button {
                margin: 0;
                padding: $ag-grid-size 0;

                input[type='radio'] {
                    @extend %radio-button;
                    margin-top: 0;
                    margin-right: 2px;
                }
            }

            .ag-checkbox {
                padding: $ag-grid-size 0;
            }
        }

        .ag-native-checkbox {
            @include ag-checkbox($ag-color-primary);
            margin-right: 2px;
        }

        input.ag-native-toggle-button {
            flex: none;
            width: unset;
            min-width: unset;
            @include ag-toggle-button;
        }

        // Format tab
        .ag-chart-format, .ag-chart-data {
            // the overflow hidden hides the halo effect - so we overwrite it here
            .ag-input-wrapper {
                overflow: visible;
            }

            textarea {
                @extend %custom-selection;
                border: 1px solid $ag-color-primary;
                border-radius: $ag-border-radius;
                padding: $ag-grid-size;
                color: $ag-color-foreground;
                background: $ag-color-background;
            }

            select {
                @extend %select;
            }

            input[type='number'] {
                @extend %input-text;
                font-size: 0.9em;
                padding-right: 0;
            }

            input[type='range'] {
                @extend %range;
            }
        }
    }

    .ag-group {
        background: $ag-color-background-alt;
    }


    .ag-charts-format-top-level-group-title-bar, .ag-charts-data-group-title-bar {
        font: $ag-font-chrome;
        background: $ag-color-background;
        @include ag-grid-border(bottom, $color: $ag-secondary-border-color);
        padding: $ag-grid-size $ag-grid-size * 2;

        .ag-column-group-icons {
            margin-left: -2px;
            margin-right: $ag-grid-size;
            transform: translateY(1px);
        }
    }

    .ag-charts-format-top-level-group-container {
        @include ag-grid-border(bottom, $color: $ag-secondary-border-color);
        margin-left: 0;
        // TODO what does this do?
        justify-content: flex-start;
        padding: $ag-grid-size $ag-grid-size * 2;

        .ag-group-item {
            margin: 0;
            margin-right: 0;
        }
    }

    .ag-charts-format-top-level-group-toolbar {
        padding: $ag-grid-size $ag-grid-size * 2;
        height: auto;
        background: $ag-color-background;
        input.ag-native-checkbox {
            @include ag-toggle-button;
        }
    }

    .ag-charts-format-sub-level-group-container {
        padding: $ag-grid-size * 2 0;
    }
    .ag-charts-format-sub-level-group-title-bar {
        padding: $ag-grid-size 0;
        height: auto;
    }

    // Color Picker
    .ag-color-picker > .ag-wrapper {
        border-radius: $ag-border-radius;
        border-color: $ag-border-color;

        & > div {
            height: $ag-grid-size * 4;
        }
    }

    .ag-picker-field-button:hover .ag-icon {
        color: $ag-color-primary;
    }

    .ag-color-panel {
        .ag-spectrum-slider {
            border: 1px solid $ag-border-color;
            box-shadow: 0 0px 1px 1px $ag-color-background;
        }
    }

    // remove styling for toggle button, we do it with ckeckboxes
    .ag-toggle-button {
        &.ag-selected .ag-input-wrapper {
            background: unset;
        }
        .ag-input-wrapper {
            background-color: unset;
            border: unset;
            border-radius: unset;
        }
    }

    .ag-angle-select {
        .ag-angle-select-field {
            .ag-angle-select-parent-circle {
                background-color: $ag-color-border-form-element;
            }
            .ag-angle-select-child-circle {
                background-color: $ag-color-background;
            }
        }
    }

    // hover effect on menu icons
    [ref='eMenu'].ag-header-icon {
        // @extend %button;
        // padding: $ag-grid-size / 2;

        .ag-icon {
            color: $ag-color-primary;
        }

        &:active .ag-icon {
            // color: $ag-color-background;
        }
    }

    // RTL Overrides
    // TODO simplify this a lot, use ag-theme-rtl, and move stuff to the base
    .ag-rtl {
        .ag-filter .ag-filter-apply-panel button + button {
            margin-left: 0;
            margin-right: $ag-grid-size * 2;
        }

        .ag-floating-filter-button {
            margin-right: $ag-grid-size / 2;
            button {
                background-position: left $ag-grid-size / 2 top $ag-grid-size / 2;
                padding-left: $ag-grid-size * 4;
            }
        }

        .ag-cell.ag-cell-inline-editing .ag-cell-edit-input select {
            background-position: left $ag-grid-size top $ag-row-height / 2 - 9;
        }

        ////////////////////////////////////////
        // Popup editing
        ////////////////////////////////////////
        .ag-popup > div.ag-popup-editor {
            .ag-input-wrapper .ag-cell-edit-input,
            .ag-cell-edit-input select {
                padding-right: $ag-grid-size * 3 - 1;
                padding-left: $ag-grid-size * 6 - 1;
            }

            // select editor
            .ag-cell-edit-input select {
                background-position: left $ag-grid-size top $ag-row-height / 2 - 9;
            }
        }

        .ag-menu-list {
            .ag-menu-option-shortcut {
                text-align: left !important;
                padding-left: 0 !important;
                padding-right: $ag-grid-size * 2 !important;
            }
        }

        ////////////////////////////////////////
        // Column Chooser
        ////////////////////////////////////////
        .ag-column-select-header {
            padding-right: $ag-grid-size * 1;

            & > [ref='eExpand'] {
                margin-right: $ag-grid-size;
                margin-left: 0;
            }

            & > [ref='eExpand'].ag-hidden + div {
                margin-right: $ag-grid-size * 2;
                margin-left: 0;
            }
        }

        .ag-column-drop-cell-drag-handle {
            margin-left: 0;
            margin-right: $ag-grid-size;
        }

        .ag-group-checkbox {
            display: block;
            // this should not be necessary, but I am negating some weird inline flex idea
            margin-top: $ag-grid-size / 2;
        }
        .ag-rich-select {
            .ag-rich-select-value {
                background-position: left $ag-grid-size top $ag-row-height / 2 - $ag-icon-size / 2;
                padding-right: $ag-cell-horizontal-padding;
            }
            .ag-rich-select-row {
                padding-right: $ag-cell-horizontal-padding;
            }
        }

        .ag-column-select .ag-column-select-header .ag-input-wrapper {
            margin-left: $ag-grid-size;
            margin-right: $ag-grid-size;
        }

        .ag-column-select .ag-column-select-column-group .ag-column-group-icons {
            margin: 0;
        }

        .ag-column-select .ag-column-select-column .ag-column-select-checkbox {
            margin: 0;
            margin-left: $ag-grid-size;
        }

        .ag-tool-panel-wrapper .ag-column-drop > div:first-child > span:first-child {
            margin-left: $ag-grid-size;
            margin-right: 0;
        }

        .ag-tool-panel-wrapper .ag-pivot-mode-panel .ag-pivot-mode-select {
            margin-right: $ag-grid-size * 2;
        }

        .ag-chart-settings-next-btn,
        .ag-chart-settings-prev-btn {
            transform: scaleX(-1);
        }

        .ag-chart-docked-container .ag-panel {
            border-left: none;
            border-right: 1px solid $ag-border-color;
        }

        .ag-group .ag-group-title-bar .ag-column-group-icons {
            margin-left: $ag-grid-size;
            margin-right: 0;
            transform: scaleX(-1);
        }

        .ag-slider > .ag-wrapper > div:not(:first-of-type),
        .ag-angle-select > .ag-wrapper > div:not(:first-of-type) {
            margin-left: 0;
            margin-right: $ag-grid-size * 2;
        }

        .ag-chart .ag-chart-format input[type='number'] {
            @extend %input-text;
            font-size: 0.9em;
            padding-right: $ag-grid-size;
            padding-left: 0;
        }
    }

    .ag-header-expand-icon {
        transform: translateY($ag-grid-size / 2);
    }
}
